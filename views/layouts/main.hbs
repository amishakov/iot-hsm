<!DOCTYPE html>
<html>
  <head>
    <title>{{title}}</title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <script src="/javascripts/ajax.js"></script>
    <script src="/js/jquery/jquery.min.js"></script>
    <script src="/js/bootstrap/bootstrap.bundle.min.js"></script>
    <link href="/css/bootstrap/bootstrap.min.css" rel="stylesheet">
    <script>
      function checkStatus() {
        let getslots = {{{slotstring}}};
        //console.log(getslots.state);
        if(getslots.state=='initializing') {
          $('#overlay').fadeIn();
          waitForSlots(function(err, resp) {
              $('#overlay').fadeOut();
              if(err) {
                  alert(err);
              } else {
                  //console.log(resp.data);
                  slots = resp.data;
                  init();
              }
          });
        } else {
          init();
        }
      }

      function waitForSlots(callback) {
        getAPIRequest('/api/pkcs11/slotstatus', function(err, resp) {
            if(err) {
                callback(resp.message, resp);
                //console.log(response);
            } else {
                //$('#overlay').fadeOut();
                if(resp.data.state == 'initializing') {
                    setTimeout(function() {
                        waitForSlots(callback);
                    }, 1000);
                } else {
                    callback(false, resp);
                }
            }
        });
    }
    </script>
  </head>
  <body>
    <header>
      <!-- Fixed navbar -->
      <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
      <a class="navbar-brand" href="/">IoT-HSM</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarCollapse">
          <ul class="navbar-nav mr-auto">
              <li class="nav-item active">
                  <a class="nav-link" href="/">Create SoftHSM2</a>
              </li>
              <!--<li class="nav-item active">
                  <a class="nav-link" href="/about-us">Update PINs</a>
              </li>-->
              <li class="nav-item active">
                  <a class="nav-link" href="/reload">Reload</a>
              </li>
          </ul>
          <span style="color: white;">Connected Slots: 0</span>
      </div>
      </nav>
    </header>
    {{{body}}}
    <div id="overlay" style="display:none;">
      <div class="spinner"></div>
        <br/>
        Processing...
    </div>
  </body>
</html>
